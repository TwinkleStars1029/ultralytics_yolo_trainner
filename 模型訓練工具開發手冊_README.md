# ğŸ§© æ¨¡å‹è¨“ç·´å·¥å…·é–‹ç™¼æ‰‹å†Šï¼ˆDesktop Trainer Toolï¼‰

## ğŸ“˜ å°ˆæ¡ˆç°¡ä»‹
æœ¬å·¥å…·ç‚ºä¸€æ¬¾æ¡Œä¸Šå‹æ‡‰ç”¨ç¨‹å¼ï¼Œå”åŠ©ä½¿ç”¨è€…å°‡å½±åƒèˆ‡æ¨™è¨»è³‡æ–™æ•´ç†ç‚ºæ¨™æº–è¨“ç·´æ ¼å¼ï¼Œä¸¦è‡ªå‹•ç”Ÿæˆå°æ‡‰çš„ `data.yaml` è¨­å®šæª”ï¼Œä»¥ä¾› YOLO / GroundingDINO / Ultralytics ç­‰æ¨¡å‹ä½¿ç”¨ã€‚

åŠŸèƒ½æ¶µè“‹ï¼š
1. å°‡è³‡æ–™è‡ªå‹•æ•´ç†æˆè¨“ç·´çµæ§‹ï¼ˆtrain / valid / testï¼‰
2. ç”Ÿæˆæ¨™æº–åŒ– YAML è¨­å®šæª”
3. æ”¯æ´ Dry-Run æ¨¡å¼ï¼ˆé è¦½å°‡åŸ·è¡Œçš„æ“ä½œï¼‰
4. å¯å¾ŒçºŒæ“´å……è‡³è‡ªå‹•å•Ÿå‹• Docker è¨“ç·´èˆ‡ ONNX åŒ¯å‡º

---

## ğŸ§± ç³»çµ±æ¶æ§‹æ¦‚è¦½

```
trainer_desktop/
â”œâ”€ app.py                      # ä¸»ç¨‹å¼ï¼ˆTkinterï¼‰
â”œâ”€ ui/
â”‚  â”œâ”€ data_prep_page.py        # è³‡æ–™æ•´ç†ä»‹é¢
â”‚  â”œâ”€ yaml_gen_page.py         # YAML ç”Ÿæˆä»‹é¢
â”‚  â””â”€ widgets.py               # å…±ç”¨å…ƒä»¶
â”œâ”€ core/
â”‚  â”œâ”€ data_prep.py             # è³‡æ–™æ•´ç†é‚è¼¯
â”‚  â”œâ”€ yaml_gen.py              # YAML ç”¢ç”Ÿæ¨¡çµ„
â”‚  â”œâ”€ env_check.py             # ç’°å¢ƒæª¢æŸ¥
â”‚  â””â”€ utils.py                 # é€šç”¨å·¥å…·
â”œâ”€ templates/
â”‚  â””â”€ data_yaml.j2             # YAML Jinja2 æ¨¡æ¿
â”œâ”€ runs/
â”‚  â””â”€ 2025-10-16_08-30-12/
â”‚     â”œâ”€ train.txt
â”‚     â”œâ”€ val.txt
â”‚     â”œâ”€ test.txt
â”‚     â”œâ”€ classes.txt
â”‚     â”œâ”€ data.yaml
â”‚     â””â”€ summary.json
â””â”€ requirements.txt
```

---

## ğŸ§® åŠŸèƒ½ä¸€ï¼š3.1 å°‡è³‡æ–™æ•´ç†ç¬¦åˆè¨“ç·´æ ¼å¼

### ğŸ“¥ è¼¸å…¥è³‡æ–™æ ¼å¼

```
img/
â”œâ”€ 0001.jpg
â”œâ”€ 0001.txt
â”œâ”€ 0002.jpg
â”œâ”€ 0002.txt
â””â”€ classes.txt
```

- `xxx.jpg`ï¼šå½±åƒæª”  
- `xxx.txt`ï¼šæ¨™è¨»æª”ï¼ˆYOLO æ ¼å¼ï¼š`class x y w h`ï¼Œçš†ç‚º 0~1 æ­£è¦åŒ–åº§æ¨™ï¼‰  
- `classes.txt`ï¼šæ¯è¡Œä¸€å€‹é¡åˆ¥åç¨±  
  ```
  DR02
  Hole
  ```

---

### ğŸ“¤ è¼¸å‡ºè³‡æ–™çµæ§‹

```
dataset_root/
â”œâ”€ train/
â”‚  â”œâ”€ images/
â”‚  â”‚  â”œâ”€ xxx.jpg
â”‚  â””â”€ labels/
â”‚     â”œâ”€ xxx.txt
â”œâ”€ valid/
â”‚  â”œâ”€ images/
â”‚  â””â”€ labels/
â”œâ”€ test/
â”‚  â”œâ”€ images/
â”‚  â””â”€ labels/
â”œâ”€ classes.txt
â”œâ”€ train.txt
â”œâ”€ val.txt
â”œâ”€ test.txt
â””â”€ data.yaml
```

---

### âš™ï¸ åŠŸèƒ½è¨­è¨ˆèˆ‡æµç¨‹

| æ­¥é©Ÿ | èªªæ˜ |
|------|------|
| **1. è®€å– classes.txt** | è§£æé¡åˆ¥åç¨±ã€å»ºç«‹ nameâ†’id å°æ‡‰ï¼›æª¢æŸ¥é‡è¤‡èˆ‡ç©ºç™½è¡Œ |
| **2. æƒæ img è³‡æ–™å¤¾** | æ‰¾å‡º `.jpg` æª”åŠå…¶å°æ‡‰ `.txt`ï¼›è‹¥æ¨™è¨»æª”ä¸å­˜åœ¨ï¼Œå¯é¸æ“‡æ˜¯å¦å…è¨±ç©ºæ¨™è¨» |
| **3. æ¨™è¨»æ ¼å¼é©—è­‰** | æª¢æŸ¥æ¯è¡Œæ˜¯å¦ç‚º 5 æ¬„ã€åº§æ¨™æ˜¯å¦åœ¨ [0,1]ï¼›é¡åˆ¥ç·¨è™Ÿæ˜¯å¦åˆæ³• |
| **4. è³‡æ–™åˆ†å‰²** | ä¾ç…§ä½¿ç”¨è€…è¼¸å…¥æ¯”ä¾‹ï¼ˆtrain/valid/testï¼‰èˆ‡å›ºå®š seed é€²è¡Œéš¨æ©Ÿåˆ‡åˆ† |
| **5. æª”æ¡ˆè¤‡è£½èˆ‡æ¸…å–®ç”Ÿæˆ** | å°‡æª”æ¡ˆè¤‡è£½è‡³å°æ‡‰ç›®éŒ„ï¼Œä¸¦ç”Ÿæˆ `train.txt / val.txt / test.txt`ï¼ˆç›¸å°è·¯å¾‘ï¼‰ |
| **6. è¼¸å‡ºçµ±è¨ˆå ±å‘Š** | ç”¢ç”Ÿ `summary.json`ï¼ŒåŒ…å«å½±åƒæ•¸é‡ã€æ¨™è¨»æ•¸é‡ã€ç©ºæ¨™è¨»æ¯”ä¾‹ã€é¡åˆ¥åˆ†å¸ƒç­‰è³‡è¨Š |

---

### ğŸ“„ ç¯„ä¾‹è¼¸å‡ºæª”æ¡ˆå…§å®¹

#### `classes.txt`
```
DR02
Hole
```

#### `train.txt`
```
./train/images/000c729f-df1b-4ed5-aa84-3890ffc46864_DR02.jpg
./train/images/00172e49-c985-4d66-953f-9919fcb31227_DR02.jpg
...
```

#### `summary.json`
```json
{
  "total_images": 1000,
  "train": 700,
  "valid": 200,
  "test": 100,
  "empty_labels": 12,
  "class_distribution": {
    "DR02": 512,
    "Hole": 476
  }
}
```

---

### ğŸ” Dry-Run æ¨¡å¼

- **ç”¨é€”**ï¼šæ¨¡æ“¬åŸ·è¡Œï¼Œä¸çœŸçš„è¤‡è£½æª”æ¡ˆã€‚
- **é¡¯ç¤ºå…§å®¹**ï¼š
  - å°‡ç”Ÿæˆçš„ç›®éŒ„çµæ§‹é è¦½
  - ä¸‰å€‹åˆ†å‰²é›†çš„å½±åƒæ•¸é‡
  - éƒ¨åˆ†æ¨£æœ¬è·¯å¾‘æ¸…å–®
- **ç”¨é€”å ´æ™¯**ï¼š
  - æª¢æŸ¥æ¯”ä¾‹è¨­å®šæ˜¯å¦åˆç†
  - é©—è­‰è·¯å¾‘èˆ‡æª”åç„¡èª¤
  - å®‰å…¨é è¦½å‰è™•ç†çµæœ

---

## ğŸ§¾ åŠŸèƒ½äºŒï¼š3.2 ç”Ÿæˆå°æ‡‰ YAML æª”

### ğŸ“˜ YAML ç”¢å‡ºè¦æ ¼

```yaml
path: /ultralytics/data/20241206_K2_DR02_v18.1  # dataset root dir
train: train.txt  # training list
val: val.txt      # validation list
test: test.txt    # test list

names:
  0: DR02
  1: Hole

stuff_names: [
  'DR02',
  'other',
  'unlabeled'
]

download: |
  from utils.general import download, Path
```

---

### âš™ï¸ è‡ªå‹•ç”Ÿæˆé‚è¼¯

| é …ç›® | èªªæ˜ |
|------|------|
| `path` | ä½¿ç”¨è€…è¨­å®šçš„è³‡æ–™é›†æ ¹ç›®éŒ„ï¼ˆçµ•å°è·¯å¾‘ï¼‰ |
| `train/val/test` | å°æ‡‰çš„æ¸…å–®æª”æ¡ˆè·¯å¾‘ |
| `names` | å¾ `classes.txt` è‡ªå‹•è§£æ |
| `stuff_names` | å¯é¸ï¼ŒUI å‹¾é¸æ˜¯å¦åŠ å…¥ |
| `download` | ä¿ç•™æ¨¡æ¿å ä½å€å¡Šï¼Œå¯ä¸å¡« |

---

### ğŸ§© Jinja2 æ¨¡æ¿ï¼ˆ`templates/data_yaml.j2`ï¼‰

```jinja2
path: "{{ path }}"
train: "train.txt"
val: "val.txt"
test: "test.txt"

names:
{% for i, name in enumerate(class_names) -%}
  {{ i }}: {{ name }}
{% endfor -%}
```

---

## ğŸ’» ä»‹é¢è¨­è¨ˆï¼ˆTkinterï¼‰

### ğŸ“‚ è³‡æ–™æ•´ç†é ï¼ˆData Prepï¼‰

| å…ƒä»¶ | åŠŸèƒ½ |
|------|------|
| è·¯å¾‘è¼¸å…¥ | é¸æ“‡è¼¸å…¥è³‡æ–™å¤¾ï¼ˆimg/ï¼‰èˆ‡è¼¸å‡ºæ ¹ç›®éŒ„ |
| åˆ†å‰²åˆè¨ˆ | train / valid / test æ¯”ä¾‹ + seed |
| é¸é … | å…è¨±ç©ºæ¨™è¨»ã€æ ¼å¼é©—è­‰é–‹é—œ |
| æŒ‰éˆ• | `[Dry-Run é è¦½]`ã€`[é–‹å§‹æ•´ç†]` |
| çµæœé¡¯ç¤º | é¡¯ç¤ºçµ±è¨ˆèˆ‡ summary.json é€£çµ |

### âš™ï¸ YAML ç”Ÿæˆé ï¼ˆYAML Generatorï¼‰

| å…ƒä»¶ | åŠŸèƒ½ |
|------|------|
| é¡¯ç¤ºé¡åˆ¥è¡¨ | è®€å– classes.txtï¼Œé è¦½é¡åˆ¥èˆ‡ç´¢å¼• |
| YAML é è¦½å€ | ä»¥æ–‡å­—å€å¡Šé¡¯ç¤º Jinja2 æ¸²æŸ“çµæœ |
| æŒ‰éˆ• | `[é è¦½ YAML]`ã€`[å¯«å…¥ data.yaml]` |

---

## ğŸ§  ä¾‹å¤–èˆ‡éŒ¯èª¤è™•ç†è¨­è¨ˆ

| ç‹€æ³ | è™•ç†æ–¹å¼ |
|------|-----------|
| `classes.txt` ä¸å­˜åœ¨ | éŒ¯èª¤æç¤ºã€Œæ‰¾ä¸åˆ°é¡åˆ¥å°æ‡‰æª”ã€ |
| æœ‰å½±åƒç„¡æ¨™è¨» | ä¾ UI è¨­å®šï¼šå…è¨±å‰‡ç”Ÿæˆç©ºæª”ï¼Œä¸å…è¨±å‰‡è·³é |
| æ¨™è¨»æ ¼å¼éŒ¯èª¤ | è¨˜éŒ„æ–¼ summary.json ä¸­ï¼›åš´æ ¼æ¨¡å¼ä¸‹ä¸­æ­¢ |
| æª”åé‡è¤‡ | è‡ªå‹•åœ¨æª”ååŠ  `_dup` å¾Œç¶´ï¼Œä¸¦æç¤º |
| ç›¸å°è·¯å¾‘éŒ¯èª¤ | è‡ªå‹•ä¿®æ­£ç‚º `./train/images/...` å½¢å¼ |
| YAML ç”Ÿæˆå¤±æ•— | æª¢æŸ¥ classes å…§å®¹æˆ–æ¬Šé™å•é¡Œä¸¦æç¤º |

---

## ğŸ§© Dry-Run é è¦½ç¯„ä¾‹

```
âœ… [Dry-Run æ¨¡æ“¬çµæœ]
--------------------------------------
ğŸ“‚ å°‡å»ºç«‹è³‡æ–™å¤¾çµæ§‹ï¼š
  - train/images (700 å¼µ)
  - valid/images (200 å¼µ)
  - test/images (100 å¼µ)
--------------------------------------
ğŸ§¾ å°‡ç”Ÿæˆï¼š
  - train.txt / val.txt / test.txt
  - classes.txt (2 é¡)
  - data.yaml
--------------------------------------
ğŸ§© ç¯„ä¾‹å½±åƒï¼š
  ./train/images/0001.jpg
  ./valid/images/0143.jpg
  ./test/images/0866.jpg
--------------------------------------
ğŸš« å°šæœªè¤‡è£½æª”æ¡ˆï¼ˆDry-Run æ¨¡å¼ï¼‰
```

---

## ğŸ§° é–‹ç™¼é‡é»èˆ‡æ“´å……æ€§

| æ¨¡çµ„ | å¯æ“´å……æ–¹å‘ |
|------|-------------|
| `core/data_prep.py` | æ”¯æ´ COCO â†’ YOLO / VOC â†’ YOLO è½‰æ› |
| `core/yaml_gen.py` | å¤šæ¡†æ¶æ¨¡æ¿ï¼ˆGroundingDINOã€YOLOv5ã€YOLOv8ï¼‰ |
| `core/env_check.py` | GPU / CUDA / Docker æª¢æŸ¥ |
| `ui/` | æ”¹ç‚º PyQt æˆ– Electron å‰ç«¯ |
| `runs/` | å¯èˆ‡ MLflow æˆ– SQLite æ•´åˆåšç´€éŒ„è¿½è¹¤ |

---

## ğŸ§¾ æ¨è–¦é–‹ç™¼é †åº
1. å®Œæˆ `data_prep.py`ï¼ˆå« Dry-Run èˆ‡ summary.json è¼¸å‡ºï¼‰  
2. å®Œæˆ `yaml_gen.py`ï¼ˆç”¨ Jinja2 æ¨¡æ¿ç”Ÿæˆ data.yamlï¼‰  
3. ä¸²æ¥ Tkinter ä»‹é¢ï¼ˆå…©é ï¼‰  
4. å¢åŠ ã€Œæ­·å²ç´€éŒ„ã€åŠŸèƒ½ï¼Œå°‡æ¯æ¬¡é‹è¡Œåƒæ•¸å¯«å…¥ `runs/`  
5. å¾ŒçºŒæ•´åˆ Docker è¨“ç·´èˆ‡ ONNX åŒ¯å‡º  

---

## âœ… ç¸½çµ

æ­¤å·¥å…·å°‡ï¼š
- **çµ±ä¸€è³‡æ–™è¼¸å…¥æ ¼å¼**
- **è‡ªå‹•ç”Ÿæˆè¨“ç·´ YAML**
- **æ”¯æ´ Dry-Run é è¦½ã€å®‰å…¨æ¸¬è©¦**
- **å®Œæ•´è¨˜éŒ„æ¯æ¬¡è™•ç†çµæœ**
  
èƒ½é¡¯è‘—æ¸›å°‘äººå·¥æ•´ç†éŒ¯èª¤èˆ‡è¨“ç·´å‰æº–å‚™æ™‚é–“ï¼Œé©åˆä¼æ¥­å…§éƒ¨è³‡æ–™æ¨™æº–åŒ–èˆ‡æ¨¡å‹å¿«é€Ÿå¯¦é©—ã€‚
